<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>client/util-sql - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-client_util-sql.html">client/util-sql</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-client_util-sql.html#~columnExpression">columnExpression</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-client_util-sql.html#~getData">getData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-client_util-sql.html#~getMetaData">getMetaData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-client_util-sql.html#~groupExpression">groupExpression</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-client_util-sql.html#~scanData">scanData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-client_util-sql.html#~setCategories">setCategories</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-client_util-sql.html#~setMinMax">setMinMax</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-client_util-sql.html#~subTableQuery">subTableQuery</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-client_util-sql.html#~whereSelected">whereSelected</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-client_util-sql.html#~whereValid">whereValid</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#queryAndCallBack">queryAndCallBack</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">client/util-sql</h1>
    

    




<section>

<header>
    
        
            
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description"><p>Utility functions for SQL datasets for use on the server</p>
<p>SELECT
  each filter.partition   where filter is from the view
  each filter.aggregate   where aggregate is from the view
  count (1)
FROM
  ...
GROUP BY
  each partition          where partition is from the view
ORDER BY
  ... for text facets either name or count
LIMIT
  ... for text facets</p>
<p>UNION ALL ( over all active tables
SELECT
  each filter.partition mapped to this dataset.facet
  each filter.aggregate mapped to this dataset.facet
  COUNT(1)
FROM
  table
WHERE
  whereValid for each partition of each filter
  whereSelected for each partition of each filter
  whereValid for each aggregate of THIS filter
GROUP BY
  each partition
)</p></div>
        

        
            
<div class="section-method">







<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line1">line 1</a>
    </li></ul></dd>
    

    

    

    
</dl>























</div>
        
    
    </div>

    

    

    

     

    

    

    
        <h3 class="subsection-title">Methods</h3>

        
            
<div class="section-method">

    

    <h4 class="name" id="~columnExpression"><span class="type-signature">(inner) </span>columnExpression<span class="signature">()</span><span class="type-signature"> &rarr; {Squel.expr}</span></h4>

    



<div class="description">
    <p>Create the FIELD part for the SQL query,
used in SELECT and WHERE.</p>
<p>This will also take care of the transforms.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line372">line 372</a>
    </li></ul></dd>
    

    

    

    
</dl>





















<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Squel.expr</code></span>


    </dd>
</dl>


<div class="param-desc">
    <p>expression</p>
</div>

    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="~getData"><span class="type-signature">(inner) </span>getData<span class="signature">()</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Get data for a filter</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line785">line 785</a>
    </li></ul></dd>
    

    

    

    
</dl>























</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="~getMetaData"><span class="type-signature">(inner) </span>getMetaData<span class="signature">()</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Get metadata for a dataset:</p>
<ul>
<li>dataTotal the total number of datapoints in the SQL table</li>
<li><p>dataSelected the total number of datapoints passing all current filters</p>
<p>SELECT
SUM(selected.count) AS selected,
SUM(total.count) AS total
FROM
UNION ALL (
SELECT
  COUNT (1) AS count
WHERE
  whereValid for each facet linked to current filters
  whereSelected for each partition of each filter, with empty selection
) AS total,
UNION ALL (
SELECT
  COUNT (1) AS count
WHERE
  whereValid for each facet linked to current filters
  whereSelected for each partition of each filter
) AS selected</p>
</li>
</ul>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line898">line 898</a>
    </li></ul></dd>
    

    

    

    
</dl>























</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="~groupExpression"><span class="type-signature">(inner) </span>groupExpression<span class="signature">()</span><span class="type-signature"></span></h4>

    







<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line295">line 295</a>
    </li></ul></dd>
    

    

    

    
</dl>























</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="~scanData"><span class="type-signature">(inner) </span>scanData<span class="signature">()</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Scan dataset and create Facets
when done, send new facets to client.</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line707">line 707</a>
    </li></ul></dd>
    

    

    

    
</dl>























</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="~setCategories"><span class="type-signature">(inner) </span>setCategories<span class="signature">(dataset, facet)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>setCategories finds finds all values on an ordinal (categorial) axis
Updates the categorialTransform of the facet</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line670">line 670</a>
    </li></ul></dd>
    

    

    

    
</dl>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>dataset</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Dataset</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>facet</code></td>
            

            <td class="type">
            
                
<span class="param-type"><code>Facet</code></span>


            
            </td>

            

            

            <td class="description last">
                
                
            </td>
        </tr>

    
    </tbody>
</table>
















</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="~setMinMax"><span class="type-signature">(inner) </span>setMinMax<span class="signature">()</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Sets minimum and maximum value on a facet</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line645">line 645</a>
    </li></ul></dd>
    

    

    

    
</dl>























</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="~subTableQuery"><span class="type-signature">(inner) </span>subTableQuery<span class="signature">()</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Get data for a filter</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line721">line 721</a>
    </li></ul></dd>
    

    

    

    
</dl>























</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="~whereSelected"><span class="type-signature">(inner) </span>whereSelected<span class="signature">()</span><span class="type-signature"> &rarr; {Squel.expr}</span></h4>

    



<div class="description">
    <p>Construct an expression for the 'WHERE' clause to filter unselected data</p>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line526">line 526</a>
    </li></ul></dd>
    

    

    

    
</dl>





















<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Squel.expr</code></span>


    </dd>
</dl>


<div class="param-desc">
    <p>expression</p>
</div>

    
</div>



</div>
        
            
<div class="section-method">

    

    <h4 class="name" id="~whereValid"><span class="type-signature">(inner) </span>whereValid<span class="signature">()</span><span class="type-signature"> &rarr; {Squel.expr}</span></h4>

    



<div class="description">
    <p>Construct an expression for the 'WHERE' clause to filter invalid data
Data is considered valid if it is not equal to one of the <code>facet.misval</code>.
The type of the misval should match that of the facet.</p>
<ul>
<li>also include IS NOT NULL (NULL values are mapped to missing values)</li>
</ul>
</div>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="sql-driver.js.html">sql-driver.js</a>, <a href="sql-driver.js.html#line65">line 65</a>
    </li></ul></dd>
    

    

    

    
</dl>





















<div class="section-returns">
<h5>Returns:</h5>

        

<dl class="param-type">
    <dt>
        Type:
    </dt>
    <dd>
        
<span class="param-type"><code>Squel.expr</code></span>


    </dd>
</dl>


<div class="param-desc">
    <p>expression</p>
</div>

    
</div>



</div>
        
    

    

    
</article>

</section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu May 18 2017 15:29:59 GMT+0200 (CEST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>